-- ----------------------------------------------------------------------------------PRUEBA 3--------------------------------------------------------------------------------------------------------

-- -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
DROP TABLE boleta;
DROP TABLE cliente;
-- ------------------------------------------------------------------------------------ TABLAS ---------------------------------------------------------------------------------------------------------

-- Tabla CATEGORIZACION
CREATE TABLE CATEGORIZACION (
  id_categorizacion NUMBER(4) NOT NULL,  
  nombre_categorizacion VARCHAR2 (15) NOT NULL,
  porcentaje NUMBER(2) NOT NULL,
  
  CONSTRAINT pk_CATEGORIZACION PRIMARY KEY (id_categorizacion)
);

CREATE SEQUENCE serie_categorizacion
START WITH 1
INCREMENT BY 1;



-- Tabla PRODUCTO
CREATE TABLE PRODUCTO (
  id_producto NUMBER(9) NOT NULL,  
  nombre_producto VARCHAR2 (15) NOT NULL,
  precio NUMBER(7) NOT NULL ,
  stock_actual NUMBER(4) NOT NULL ,
  stock_minimo NUMBER(2) NOT NULL ,
  
  id_fabrica NUMBER(2) NOT NULL,  
  id_categorizacion NUMBER(4) NOT NULL,  
  id_detalle_boleta NUMBER(6) NOT NULL,

  CONSTRAINT pk_PRODUCTO PRIMARY KEY (id_producto)
);
  


CREATE SEQUENCE serie_producto_2
START WITH 1
INCREMENT BY 1;




-- Tabla DETALLE_BOLETA
CREATE TABLE DETALLE_BOLETA (
  id_detalle_boleta NUMBER(6) NOT NULL,  
  cantidad_productos NUMBER(3) NOT NULL ,
  
  id_boleta NUMBER(6) NOT NULL,  

  CONSTRAINT pk_DETALLE_BOLETA PRIMARY KEY (id_detalle_boleta)
);

CREATE SEQUENCE serie_detalle_boleta
START WITH 1
INCREMENT BY 1;


-- Tabla BOLETA
CREATE TABLE BOLETA (
  id_boleta NUMBER(6) NOT NULL,  
  fecha_boleta DATE NOT NULL,
  
  id_detalle_boleta NUMBER(6) NOT NULL,  

  CONSTRAINT pk_BOLETA PRIMARY KEY (id_boleta)
);

CREATE SEQUENCE serie_boleta
START WITH 1010
INCREMENT BY 10;




-- Tabla FABRICA
CREATE TABLE FABRICA (
  id_fabrica NUMBER(2) NOT NULL,  
  nombre_fabrica VARCHAR2 (15) NOT NULL,
  
  CONSTRAINT pk_FABRICA PRIMARY KEY (id_fabrica)
);

CREATE SEQUENCE serie_fabrica
START WITH 5
INCREMENT BY 5;




-- Tabla CONTRATO
CREATE TABLE CONTRATO (
  id_contrato NUMBER(5) NOT NULL,  
  fecha_contrato DATE NOT NULL,
  sueldo NUMBER(7) NOT NULL ,
  comision NUMBER(2) NOT NULL ,
  
  id_empleado NUMBER(5) NOT NULL,

  CONSTRAINT chk_comision CHECK (comision >= 12 and comision <= 25),
  CONSTRAINT pk_CONTRATO PRIMARY KEY (id_contrato)
);

CREATE SEQUENCE serie_contrato
START WITH 1
INCREMENT BY 1;



-- Tabla EMPLEADO
CREATE TABLE EMPLEADO (
  id_empleado NUMBER(5) NOT NULL,  
  rut_empleado NUMBER(9) NOT NULL ,
  primer_nombre VARCHAR2 (15) NOT NULL,
  segundo_nombre VARCHAR2 (15) NOT NULL,
  apellido_paterno VARCHAR2 (15) NOT NULL,
  apellido_materno VARCHAR2 (15) NOT NULL,
  fecha_de_nacimiento DATE NOT NULL,
  
  id_contrato NUMBER(5) NOT NULL,  
  id_fabrica NUMBER(2) NOT NULL,  
  id_equipo NUMBER(4) NOT NULL, 
  
  CONSTRAINT pk_EMPLEADO PRIMARY KEY (id_empleado)
);

CREATE SEQUENCE serie_empleado
START WITH 1
INCREMENT BY 1;



-- Tabla EQUIPO
CREATE TABLE EQUIPO (
  id_equipo NUMBER(4) NOT NULL,  
  nombre_equipo VARCHAR2 (15) NOT NULL,
  porcentaje NUMBER(2) NOT NULL,

  CONSTRAINT pk_EQUIPO PRIMARY KEY (id_equipo)
);

CREATE SEQUENCE serie_equipo
START WITH 1
INCREMENT BY 1;


-- ---------------------------------------------------------MODIFICACIONES A LLAVES FORÁNEAS----------------------------------------------
-- TABLA PRODUCTO
ALTER TABLE PRODUCTO
     ADD CONSTRAINT fk_id_fabrica
     FOREIGN KEY (id_fabrica)
     REFERENCES FABRICA (id_fabrica);
     
ALTER TABLE PRODUCTO
     ADD CONSTRAINT fk_id_categorizacion
     FOREIGN KEY (id_categorizacion)
     REFERENCES CATEGORIZACION (id_categorizacion);
     
ALTER TABLE PRODUCTO
     ADD CONSTRAINT fk_id_detalle_boleta
     FOREIGN KEY (id_detalle_boleta)
     REFERENCES DETALLE_BOLETA (id_detalle_boleta);
     
-- TABLA CONTRATO
ALTER TABLE CONTRATO
     ADD CONSTRAINT fk_id_empleado
     FOREIGN KEY (id_empleado)
     REFERENCES EMPLEADO (id_empleado);
     
-- TABLA EMPLEADO
ALTER TABLE EMPLEADO
     ADD CONSTRAINT fk_id_contrato
     FOREIGN KEY (id_contrato)
     REFERENCES CONTRATO (id_contrato);
     
ALTER TABLE EMPLEADO
     ADD CONSTRAINT fk_id_fabrica_2
     FOREIGN KEY (id_fabrica)
     REFERENCES FABRICA (id_fabrica);
     
ALTER TABLE EMPLEADO
     ADD CONSTRAINT fk_id_equipo
     FOREIGN KEY (id_equipo)
     REFERENCES EQUIPO (id_equipo);
     
-- TABLA BOLETA
ALTER TABLE BOLETA
     ADD CONSTRAINT fk_id_detalle_boleta_2
     FOREIGN KEY (id_detalle_boleta)
     REFERENCES DETALLE_BOLETA (id_detalle_boleta);
     
-- TABLA DETALLE_BOLETA
ALTER TABLE DETALLE_BOLETA
     ADD CONSTRAINT fk_id_boleta
     FOREIGN KEY (id_boleta)
     REFERENCES BOLETA (id_boleta);
     

-- ---------------------------------------------------------MODIFICACION CHECK PRODUCTO ----------------------------------------------


ALTER TABLE PRODUCTO ADD CHECK (stock_actual > stock_minimo);


-- ---------------------------------------------------------INSERT----------------------------------------------
-- INSERT CATEGORIZACION
INSERT INTO CATEGORIZACION (id_categorizacion,  nombre_categorizacion, porcentaje)
VALUES (serie_categorizacion.nextval,'lista A', 17.5);
INSERT INTO CATEGORIZACION (id_categorizacion,  nombre_categorizacion, porcentaje)
VALUES (serie_categorizacion.nextval,'lista B', 12.6);
INSERT INTO CATEGORIZACION (id_categorizacion,  nombre_categorizacion, porcentaje)
VALUES (serie_categorizacion.nextval,'lista C', 9.4);
INSERT INTO CATEGORIZACION (id_categorizacion,  nombre_categorizacion, porcentaje)
VALUES (serie_categorizacion.nextval,'lista D', 7.2);
INSERT INTO CATEGORIZACION (id_categorizacion,  nombre_categorizacion, porcentaje)
VALUES (serie_categorizacion.nextval,'lista E', 5.4);

-- INSERT PRODUCTO
INSERT INTO PRODUCTO (id_producto,  nombre_producto, precio, stock_actual, stock_minimo, id_fabrica, id_categorizacion, id_detalle_boleta )
VALUES (serie_producto_2.nextval,'categoria', 15);

-- INSERT DETALLE_BOLETA
INSERT INTO DETALLE_BOLETA (id_detalle_boleta,  cantidad_productos)
VALUES (serie_detalle_boleta.nextval, 15);

-- INSERT FABRICA
INSERT INTO FABRICA (id_fabrica,  nombre_fabrica)
VALUES (serie_fabrica.nextval,'costa');
INSERT INTO FABRICA (id_fabrica,  nombre_fabrica)
VALUES (serie_fabrica.nextval,'ambrosoli');
INSERT INTO FABRICA (id_fabrica,  nombre_fabrica)
VALUES (serie_fabrica.nextval,'nestle');
INSERT INTO FABRICA (id_fabrica,  nombre_fabrica)
VALUES (serie_fabrica.nextval,'dos en uno');
INSERT INTO FABRICA (id_fabrica,  nombre_fabrica)
VALUES (serie_fabrica.nextval,'arcor');

-- INSERT CONTRATO
INSERT INTO CONTRATO (id_contrato,  fecha_contrato, sueldo, comision, id_empleado)
VALUES (serie_contrato.nextval,'categoria', 15);

-- INSERT EMPLEADO
INSERT INTO EMPLEADO (id_empleado,  rut_empleado, primer_nombre, segundo_nombre, apellido_paterno, apellido_materno, fecha_de_nacimiento , id_contrato , id_fabrica, id_equipo  )
VALUES (serie_empleado.nextval,'categoria', 15);

-- INSERT EQUIPO
INSERT INTO EQUIPO (id_equipo,  nombre_equipo, porcentaje)
VALUES (serie_equipo.nextval,'equipo A', 8.56);
INSERT INTO EQUIPO (id_equipo,  nombre_equipo, porcentaje)
VALUES (serie_equipo.nextval,'equipo B', 10.48);
INSERT INTO EQUIPO (id_equipo,  nombre_equipo, porcentaje)
VALUES (serie_equipo.nextval,'equipo C', 11.27);
INSERT INTO EQUIPO (id_equipo,  nombre_equipo, porcentaje)
VALUES (serie_equipo.nextval,'equipo D', 7.24);

-- INSERT BOLETA
INSERT INTO BOLETA (id_equipo,  nombre_equipo, porcentaje)
VALUES (serie_boleta.nextval,'categoria', 15);





---- ------------------------------------------------------- BORRAR -------------------------------------------------------
DROP TABLE VENDEDOR;

ALTER TABLE ARTICULO DROP CONSTRAINT fk_id_marca -- elimina la llave p/f al eliminar la restricción

DELETE FROM ARTICULO WHERE nombre_columna = 'el valor que tiene la casilla de esa columna'; -- elimina una fila

DELETE FROM MARCA; -- elimina todas las filas de una tabla




-- ------------------------MODIFICACIONES  ELIMINAR TABLA, AGREGAR TABLA Y RESTRICCIÓN UNIQUE---------------------------------------------------

ALTER TABLE ARTICULO DROP (id_marca) -- borra una columna

ALTER TABLE id_marca ADD (nombre_columna NUMBER(6) NOT NULL UNIQUE) -- agrega una nueva columna UNICA

ALTER TABLE ARTICULO ADD (id_marca NUMBER (10) NOT NULL ) -- agrega una nueva columna UNICA




-- --------------------------------------------------AGREGAR UN CHECK A UNA TABLA YA --------------------------------------------------------------------------

ALTER TABLE ARTICULO ADD CHECK (stock_actual > stock_minimo); --  Este se usa al tener ya creada la tabla

CONSTRAINT chk_stock_actual CHECK (stock_actual > stock_minimo); -- Este se usa al momento de crear la tabla



     
-- --------------------------------------------------MODIFICACIONES A LLAVES PRIMARIAS--------------------------------------------------------------------------
-- ----------------------------------------------------------------------------------------------------------------------------
ALTER TABLE FACTURA PRIMARY KEY (id_factura)